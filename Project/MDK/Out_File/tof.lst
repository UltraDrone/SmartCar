C251 COMPILER V5.60.0,  tof                                                                06/07/24  23:05:08  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE tof
OBJECT MODULE PLACED IN .\Out_File\tof.obj
COMPILER INVOKED BY: G:\Keil_v5\C251\C251\BIN\C251.EXE ..\CODE\tof.c XSMALL INTR2 WARNINGLEVEL(3) OPTIMIZE(0,SPEED) BROW
                    -SE INCDIR(..\..\Libraries\libraries;..\..\Libraries\seekfree_libraries;..\..\Libraries\seekfree_peripheral;..\CODE;..\US
                    -ER\inc;..\USER\src;..\CODE) DEBUG PRINT(.\Out_File\tof.lst) OBJECT(.\Out_File\tof.obj) 

stmt  level    source

    1          #include "tof.h"
    2          
    3          // ÈüµÀÔªËØTOF´¥·¢
    4          uint8 Tof_Trig[Tof_Trig_Num] = {1, 2, 0};                       // µÚi´Î´¥·¢µÄÔªËØÊÇÊ²Ã´, 1:ÕÏ°­Îï      2:ÆÂµÀ
    5          uint8 Tof_Index = 0;                                                                                            // ´¥·¢Êý×éË÷Òý
    6          
    7          // ´ò½ÇÑÓÊ±Êý×é
    8          int16 Anti_Block[][4] = {       // ×ó´ò½ÇÕ¼¿Õ±È                          ´ò½ÇÊ±¼ä                ÓÒ´ò½ÇÕ¼¿Õ±È                            ´ò½ÇÊ±¼ä
    9              {Steer_ObsLeft_Duty, T_Move_Left, Steer_ObsRight_Duty, T_Move_Right},               // ×ó±ß·¢³µ£¬×ó->ÓÒ
   10              {Steer_ObsLeft_Duty,    40,     Steer_ObsRight_Duty,    25},                                        // ÓÒ±ß·¢³µ£¬ÓÒ->×ó
   11          };
   12          
   13          // ÆÂµÀÓëºá¶Ï±êÖ¾Î»
   14          uint8 Flag_Tof_Finish = 0;
   15          uint8 Flag_Slope = 0;
   16          uint8 Flag_Irrelevant = 0;
   17          
   18          int16 T_Tof = 0;                                                                                                        // ºá¶Ï¼ÆÊ±±äÁ¿
   19          
   20          
   21          // 1£º×ó´ò½Ç  2£ºÖ±×ß  3£ºÓÒ´ò½Ç  4£º¸´Î»±êÖ¾Î» 5£ºÍê³É±ÜÕÏ
   22          uint8 Obstacle_Step = 0;                                                                // ±ÜÕÏ²½Öè±êÖ¾Î»
   23          
   24          
   25          void Tof_Init(void)
   26          {
   27   1          while(dl1b_init())
   28   1          {
   29   2              delay_ms(200);
   30   2              printf("VL53L0X init try again.\r\n");
   31   2          }
   32   1      }
   33          
   34          void Tof_Control(void)
   35          {
   36   1      //       if(Flag_OpenLoop == 0 && Obstacle_Step == 0)                           // ±Õ»·¿ØÖÆ¹ý³ÌÖÐ¼ì²â¾àÀë
   37   1          dl1b_get_distance();                                                                                                                                // »ñÈ¡¾àÀë
   38   1          Tof_Detect();                                       // Í¨¹ýtof¼ì²â ¸ü¸Ä±êÖ¾Î» ÀûÓÚÌøÈë¶ÔÓ¦´¦Àí
   39   1          Block_handler(Default_Dir, Anti_Block[Default_Dir]); // Èç¹ûtof¼ì²âµ½µÄÊÇÕÏ°­Îï£¬µ÷ÓÃº¯Êý´¦Àí 0 ´ú±í×
             -ó±ß  1  ÓÒ±ß
   40   1          Irrelevant_handler();                                                                                                                               // ±»ÎÞ¹ØµÄ¶«Î÷´¥·¢£¬±ÈÈçÇ½
   41   1          Slope_handler();
   42   1      }
   43          
   44          void Tof_Detect(void)
   45          {
   46   1          if(Tof_Index < Tof_Trig_Num && /*dis_test < 50*/dl1b_distance_mm < Dectect_Threshold_mm)                    // »¹Î´¼ì²
             -â¹ýÕÏ°­Îï²¢ÇÒ¼ì²â½á¹ûÐ¡ÓÚãÐÖµ ÇÒÐèÎªÆðÊ¼¶¯×÷
   47   1          {
   48   2              // Í¨¹ý²é¿´Êý×é[index]µÃÖª¶ÔÓ¦´¦Àítf¼ì²âµÄ½á¹û
   49   2              // Èç¹û arr[index]==1 ÊÇÕÏ°­Îï
   50   2              if(Tof_Trig[Tof_Index] == 1 && Obstacle_Step == 0)
   51   2              {
   52   3                  LightOn;                                                                            // ¼ì²âµ½µÄÊ±ºòÏÈÁÁµÆ
   53   3                              BUZZOn;
   54   3                  Flag_OpenLoop = 1;                                  // Ö´ÐÐ¿ª»·±ÜÕÏ¿ØÖÆ
   55   3                  Obstacle_Step = 1;                                  // ±ÜÕÏ²½Öè±êÖ¾Î»
C251 COMPILER V5.60.0,  tof                                                                06/07/24  23:05:08  PAGE 2   

   56   3              }
   57   2      
   58   2              // Èç¹û arr[index]==2 ¾ÍÊÇÆÂµÀ
   59   2              else if(Tof_Trig[Tof_Index] == 2)
   60   2              {
   61   3                  LightOn;
   62   3                  Flag_Slope = 1;                                                     // ÆÂµÀ±êÖ¾Î»
   63   3              }
   64   2      
   65   2              // Èç¹û arr[index]==3 ¾Í²»×ö´¦Àí£¬·ÀÖ¹×²Ç½£¬ Èç¹ûÏÖ³¡µ÷ÊÔ³öÏÖ×²Ç½¼ì²âÔòÍ¨¹ýÊÖ¶¯Ìø¹ý±¾´Î¼ì²âµÄËã·¨
   66   2              else if(Tof_Trig[Tof_Index] == 3)
   67   2              {
   68   3                  LightOn;
   69   3                  Flag_Irrelevant = 1;
   70   3              }
   71   2          }
   72   1      
   73   1      }
   74          
   75          /*******************±ÜÕÏ´¦Àíº¯Êý***********************
   76          //  @brief      ±ÜÕÏ´¦Àí
   77          //  @param      lr£º 0£º×óµ½ÓÒ  1£ºÓÒµ½×ó
   78          //  @return     void
   79          //  @attention  ±ÜÕÏ´¦Àí·Ö³ÉËÄ¸ö²½ÖèÖ´ÐÐ£¬ÏÈ´ò½Ç¹Õ³öÈ¥
   80                                                                          ºóÖ±ÐÐÒ»Ð¡¶ÎÊ±¼äÔÙÍù»Ø´ò¡£Obstacle_Step
   81                                                                          ¶ÔÓ¦µÄÎª²»Í¬µÄÖ´ÐÐ½×¶Î¡£
   82          ******************************************************/
   83          void Block_handler(uint8 lr, int16 *pt)
   84          {
   85   1          if(!lr)                                                                                                                                                                                     // ×ó -> ÓÒ
   86   1          {
   87   2              if(Obstacle_Step == 1)                                                                                                          // ×ó´ò½Ç
   88   2              {
   89   3                  T_Tof = 0;
   90   3                  OpenLoop_Speed = Speed_Tof;                                                                         // ½µµÍËÙ¶È
   91   3                  //pwm_duty(Steer_Pin, pt[0]);                                                                               // ¶æ»ú×ó´ò½Ç
   92   3                              Turn_PWM = -750;
   93   3                  if(T_Tof >= pt[1])                                                                                                          // 30ms*20 = 0.6s
   94   3                  {
   95   4                      Obstacle_Step = 2;
   96   4                      T_Tof = 0;
   97   4                  }
   98   3              }
   99   2      
  100   2              // Ö±×ß
  101   2              else if(Obstacle_Step == 2)
  102   2              {
  103   3                  T_Tof++;
  104   3                  //pwm_duty(Steer_Pin, Steer_Duty_Midle);                    // ¶æ»ú´òÖ±
  105   3                              Turn_PWM = 0;
  106   3                  if(T_Tof >= T_Move_Straight)                                                                // 30ms*10 = 0.3s
  107   3                  {
  108   4                      Obstacle_Step = 3;
  109   4                      T_Tof = 0;
  110   4                  }
  111   3              }
  112   2      
  113   2              // ÓÒ´ò½Ç
  114   2              else if(Obstacle_Step == 3)
  115   2              {
  116   3                  T_Tof++;
  117   3                  //pwm_duty(Steer_Pin, pt[2]);                       // ¶æ»ú´òÓÒ
  118   3                              Turn_PWM = +750;
  119   3                  if(T_Tof >= pt[3])                                                  // 30ms*20 = 0.6s
  120   3                  {
  121   4                      Obstacle_Step = 4;
C251 COMPILER V5.60.0,  tof                                                                06/07/24  23:05:08  PAGE 3   

  122   4                      T_Tof = 0;
  123   4                  }
  124   3              }
  125   2      
  126   2              // ¸´Î»±êÖ¾Î»
  127   2              else if(Obstacle_Step == 4)
  128   2              {
  129   3                  Obstacle_Step = 5;                  // ÈôÐèÒªÖØ¸´¼ì²âÕÏ°­Îï£¬¿É½«´Ë±êÖ¾Î»¸´Î»Îª0
  130   3                  //                          Flag_Tof_Finish = 1;            // ·ÀÖ¹¶þ´Î±ÜÕÏ
  131   3                  Flag_OpenLoop = 0;                  // ·µ»¹×ªÏò±Õ»·¿ØÖÆ
  132   3                  LightOff;                                                           // ±ÜÕÏ½áÊø£¬¹ØµÆ
  133   3                  Tof_Index++;                                                // Íê³ÉÒ»´Î¼ì²â
  134   3      
  135   3              }
  136   2          }
  137   1      
  138   1          else                                                                                                                                                // ÓÒ -> ×ó
  139   1          {
  140   2              // ÓÒ´ò½Ç
  141   2              if(Obstacle_Step == 1)
  142   2              {
  143   3                  T_Tof++;
  144   3                  OpenLoop_Speed = Speed_Tof;                                                                         // ½µµÍËÙ¶È
  145   3                  pwm_duty(Steer_Pin, pt[2]);                                                                         // ¶æ»úÓÒ´ò½Ç
  146   3      
  147   3                  if(T_Tof == pt[3])                                                                                                          // 30ms*20 = 0.6s
  148   3                  {
  149   4                      Obstacle_Step = 2;
  150   4                      T_Tof = 0;
  151   4                  }
  152   3              }
  153   2      
  154   2              // Ö±×ß
  155   2              if(Obstacle_Step == 2)
  156   2              {
  157   3                  T_Tof++;
  158   3                  pwm_duty(Steer_Pin, Steer_Duty_Midle);                      // ¶æ»ú´òÖ±
  159   3      
  160   3                  if(T_Tof == T_Move_Straight)                                                                // 30ms*n
  161   3                  {
  162   4                      Obstacle_Step = 3;
  163   4                      T_Tof = 0;
  164   4                  }
  165   3              }
  166   2      
  167   2              // ×ó´ò½Ç
  168   2              if(Obstacle_Step == 3)
  169   2              {
  170   3                  T_Tof++;
  171   3                  pwm_duty(Steer_Pin, pt[0]);                                                                 // ¶æ»ú´ò×ó
  172   3      
  173   3                  if(T_Tof == pt[1])                                                                                                  // 30ms*n
  174   3                  {
  175   4                      Obstacle_Step = 4;
  176   4                      T_Tof = 0;
  177   4                  }
  178   3              }
  179   2      
  180   2              // ¸´Î»±êÖ¾Î»
  181   2              if(Obstacle_Step == 4)
  182   2              {
  183   3                  Obstacle_Step = 5;                  // ÈôÐèÒªÖØ¸´¼ì²âÕÏ°­Îï£¬¿É½«´Ë±êÖ¾Î»¸´Î»Îª0
  184   3                  //                          Flag_Tof_Finish = 1;            // ·ÀÖ¹¶þ´Î±ÜÕÏ
  185   3                  Flag_OpenLoop = 0;                  // ·µ»¹×ªÏò±Õ»·¿ØÖÆ
  186   3                  LightOff;                                                           // ±ÜÕÏ½áÊø£¬¹ØµÆ
  187   3                  Tof_Index++;                                                // Íê³ÉÒ»´Î¼ì²â
C251 COMPILER V5.60.0,  tof                                                                06/07/24  23:05:08  PAGE 4   

  188   3      
  189   3                  //                          while(1)                                                        // µ÷ÊÔ±ÜÕÏÊ±Ê¹ÓÃ
  190   3                  //                                  go_motor(0,0);
  191   3              }
  192   2          }
  193   1      }
  194          
  195          
  196          
  197          void Slope_handler(void)
  198          {
  199   1          if(Flag_Slope == 1)
  200   1          {
  201   2              T_Tof++;
  202   2      
  203   2              if(T_Tof == T_PassSlope)
  204   2              {
  205   3                  T_Tof = 0;
  206   3                  Flag_Slope = 0;
  207   3                  Tof_Index++;
  208   3                  LightOff;
  209   3              }
  210   2          }
  211   1      }
  212          
  213          
  214          void Irrelevant_handler(void)
  215          {
  216   1          if(Flag_Irrelevant == 1)
  217   1          {
  218   2              T_Tof++;
  219   2      
  220   2              if(T_Tof == T_Passround_Irrl)
  221   2              {
  222   3                  T_Tof = 0;
  223   3                  Tof_Index++;
  224   3                  Flag_Irrelevant = 0;
  225   3                  LightOff;
  226   3              }
  227   2          }
  228   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       822     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =        31     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        84     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
